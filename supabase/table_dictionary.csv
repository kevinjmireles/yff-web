schema,table,purpose,key_fields,relationships,used_in_v2_1,notes
public,audience_members,Temporary/import table for campaign-specific audiences (email + geo/campaign tag).,"id (PK), email, campaign_tag",None enforced; standalone staging table,No,Kept for ad-hoc audience loads; current send flow targets profiles/subscriptions instead.
public,backup_official_contacts_20250816,One-time backup snapshot of official contact methods.,"contact_id, official_id",Historical only,No,Backup only; do not modify or depend on.
public,backup_officials,One-time backup snapshot of officials roster.,official_id,Historical only,No,Backup only; do not modify or depend on.
public,campaign_runs,Log of campaign executions keyed by campaign_tag/article_key with a send_batch_id.,id (PK),None enforced,No,Superseded by send_jobs + delivery_attempts for current pipeline.
public,content_blocks,V1 block model for article parts (subject/title/dek/byline/body) per ocd_id.,id (PK),None enforced,Legacy,Replaced by v2 content CSVs (v2_content_items*).
public,content_datasets,Logical grouping of content (each upload/CSV) with lifecycle status.,"id (PK), name, status","Referenced by content_items, v2_content_items, ingest_runs, send_jobs",Yes,Core table: create a dataset before import/promote/send.
public,content_items,V1 content items with target_ocd_ids and visibility flags.,"id (PK), dataset_id (FK)",FK -> content_datasets.id,Legacy,Kept for older runs; current send flow uses v2 tables.
public,content_slices,"Article/section-oriented content (headline, dek, body_md) for web rendering.","id (PK), article_key",Standalone; web-focused,No,Not used by current email send pipeline.
public,dead_letters,Catch-all for failed jobs/messages with payload + error.,id (PK),Standalone,Yes,Used for debugging failures during import/send flows.
public,delivery_attempts,Per-user per-item attempt tracking for sends (queued/sent/error + message_id).,"id (PK), send_job_id (FK), user_id (FK), content_item_id (FK)",FK -> send_jobs.id; FK -> profiles.user_id; FK -> v2_content_items.id,Yes,Authoritative attempts ledger for v2 pipeline.
public,delivery_events,"Normalized event log (delivered, open, click, bounce, etc.)","id (PK), email, event_type, event_at",Standalone (often paired with provider_events),Optional,"Populate via webhook processors; present in schema, usage depends on webhook wiring."
public,delivery_history,V1 per-subscriber delivery history linked to content_items.,"id (PK), subscriber_id (FK), content_item_id (FK)",FK -> subscribers.id; FK -> content_items.id,Legacy,Superseded by delivery_attempts in v2.
public,geo_metrics,"Key-value geo metrics derived from address/OCI (resolver results, tags).","id (PK), user_id (FK), metric_key, metric_value",FK -> profiles.user_id,Yes,Populated by address/ocd resolver; supports targeting/analytics.
public,ingest_runs,"Audit of dataset imports (rows processed, inserted, updated, failed).","id (PK), dataset_id (FK)",FK -> content_datasets.id,Yes,Source of truth for import diagnostics and acceptance.
public,official_contacts,"Contact methods for officials (phone, webform, email, social, address).","contact_id (PK), official_id (FK)",FK -> officials.official_id,No,Present for future civics directory features; not required for email MVP.
public,officials,"Roster of elected officials (federal focus), with IDs and status.",official_id (PK),Referenced by official_contacts,No,Present for future civics directory features; not required for email MVP.
public,profiles,Primary person record (single source of truth): email + address + ocd_ids.,"user_id (PK), email (UNIQUE)","Referenced by geo_metrics, subscriptions, delivery_attempts",Yes,Use profiles instead of subscribers for all new features.
public,provider_events,"Raw inbound provider webhook payloads (e.g., SendGrid) with timestamps.","id (PK), provider, received_at",Standalone; often fed into delivery_events,Optional,Enable once webhook endpoint is live; useful for forensics/compliance.
public,rate_limit_counters,Lightweight sliding-window counters by key for API rate limiting.,key + bucket_start (PK),Standalone,No,Included for safety; not currently enforced in app router.
public,send_jobs,Top-level send job (dataset + timestamps + aggregated totals/status).,"id (PK), dataset_id (FK)",FK -> content_datasets.id; joined by delivery_attempts,Yes,Create via /api/send/start; progressed by /api/send/run.
public,subscribers,Legacy newsletter subscriber table with confirmation/unsubscribe tokens.,"id (PK), email (UNIQUE)",Referenced by delivery_history,Legacy,Superseded by profiles; keep for historical data only.
public,subscriptions,"Per-user list membership (e.g., list_key='general'); unsubscribe tracking.","id (PK), user_id (FK)",FK -> profiles.user_id,Yes,Current MVP uses list membership to target audiences and respect unsubscribes.
public,v2_content_items,V2 normalized content rows used for sending (subject/body_md/ocd_scope/metadata).,"id (PK), dataset_id (FK), row_uid",FK -> content_datasets.id; referenced by delivery_attempts,Yes,Primary content table for send pipeline.
public,v2_content_items_staging,Landing zone for CSV upload prior to promote/merge into v2_content_items.,"id (PK), dataset_id, row_uid",Promoted into v2_content_items,Yes,Use for safe idempotent imports; clear/merge via promote step.
